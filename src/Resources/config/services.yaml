parameters:
  doctrine_session_table_name: 'sessions'
  doctrine_session_ttl: 86400
  default_session_name: 'PHPSESSID'

services:
  _defaults:
    autowire: true
    autoconfigure: true
    public: false

  Psr\SimpleCache\CacheInterface:
    class: Symfony\Component\Cache\Psr16Cache
    arguments:
      - '@cache.app'

  Tourze\DoctrineSessionBundle\Command\:
    resource: '../../Command/'
  Tourze\DoctrineSessionBundle\EventSubscriber\:
    resource: '../../EventSubscriber/'
  Tourze\DoctrineSessionBundle\Service\:
    resource: '../../Service/'
  Tourze\DoctrineSessionBundle\Storage\:
    resource: '../../Storage/'
  Tourze\DoctrineSessionBundle\Manager\:
    resource: '../../Manager/'

  Tourze\DoctrineSessionBundle\Storage\SessionRepositoryInterface:
    class: Tourze\DoctrineSessionBundle\Storage\PdoSessionRepository
    public: true
    arguments:
      - '@doctrine.dbal.doctrine_session_connection'
      - '@logger'
      - '@Psr\SimpleCache\CacheInterface'
      - '%doctrine_session_table_name%'
      - '%doctrine_session_ttl%'

  Tourze\DoctrineSessionBundle\Manager\SessionManagerInterface:
    class: Tourze\DoctrineSessionBundle\Manager\RequestSessionManager
    public: true
    arguments:
      - '@Tourze\DoctrineSessionBundle\Storage\SessionRepositoryInterface'
      - '@logger'

  Tourze\DoctrineSessionBundle\Service\PdoSessionHandler:
    arguments:
      - '@Tourze\DoctrineSessionBundle\Storage\SessionRepositoryInterface'
      - '@logger'
      - '%doctrine_session_ttl%'

  Tourze\DoctrineSessionBundle\Storage\HttpSessionStorage:
    arguments:
      $sessionName: '%env(resolve:default:default_session_name:DOCTRINE_SESSION_NAME)%'

  Tourze\DoctrineSessionBundle\Service\HttpSessionFactory:
    arguments:
      $logger: '@logger'
      $sessionHandler: '@Tourze\DoctrineSessionBundle\Service\PdoSessionHandler'
      $sessionName: 'PHPSESSID'
      $requestStack: '@request_stack'
